<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Notifica√ß√£o - Dashboard</title>
    <style>
    /* --- VARI√ÅVEIS --- */
    :root {
        --primary-color: #0077cc;
        --primary-hover: #005fa3;
        --bg-body: #c7c9c9;
        --bg-card: #ffffff;
        --text-main: #1f1d1d;
        --border-color: #dcdde6;
        --input-bg: #d8e2e3;
        --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        --border-radius: 8px;
        --drop-zone-bg: #f8f9fa;
        --drop-zone-border: #cbd5e0;
    }

    /* Temas Padr√£o */
    body.theme-gold { --primary-color: #b8860b; --primary-hover: #8b6508; }
    body.theme-pink { --primary-color: #e91e63; --primary-hover: #c2185b; }
    body.theme-purple { --primary-color: #9c27b0; --primary-hover: #7b1fa2; }
    
    body.theme-dark {
        --primary-color: #4a9eff; --primary-hover: #0077cc;
        --bg-body: #121212; --bg-card: #1e1e1e;
        --text-main: #e0e0e0; --border-color: #333;
        --input-bg: #2d2d2d; --drop-zone-bg: #252525; --drop-zone-border: #444;
    }

    /* --- TEMA PALMEIRAS (VERD√ÉO) --- */
    body.theme-palmeiras { 
        --primary-color: #006437; 
        --primary-hover: #044427; 
        
        /* Fundo Verde Escuro + Escudo Centralizado */
        --bg-body: #003015; 
        
        /* Transpar√™ncia no cart√£o (Efeito Vidro) */
        --bg-card: rgba(255, 255, 255, 0.85); 
        
        --border-color: #006437;  
        --input-bg: rgba(255, 255, 255, 0.6);     
        --drop-zone-border: #006437;

        /* Imagem de Fundo Gigante */
        background-image: url('https://upload.wikimedia.org/wikipedia/commons/1/10/Palmeiras_logo.svg');
        background-repeat: no-repeat;
        background-position: center center;
        background-size: 55vh; /* Tamanho proporcional √† altura */
        background-attachment: fixed;
    }

    /* Aplica o desfoque (Blur) apenas no tema Palmeiras */
    body.theme-palmeiras .form-container,
    body.theme-palmeiras .button-row {
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }

    /* Escudo Pequeno na Barra de Bot√µes (Apenas Palmeiras) */
    body.theme-palmeiras .button-row {
        background-image: url('https://upload.wikimedia.org/wikipedia/commons/1/10/Palmeiras_logo.svg');
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 35px;
        padding-right: 60px; /* Empurra os bot√µes para a esquerda */
    }

    /* --- LAYOUT "TRAVADO" NA TELA (APP STYLE) --- */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Remove rolagem da p√°gina inteira */
        font-family: var(--font-family);
        background-color: var(--bg-body); /* Alterado para suportar cor de fundo s√≥lida atr√°s da imagem */
        color: var(--text-main);
        transition: background-color 0.5s ease;
    }

    #container { 
        display: flex; 
        height: 100vh; /* Ocupa 100% da altura da viewport */
        padding: 11px; 
        box-sizing: border-box;
        gap: 15px;
        position: relative;
        z-index: 2; /* Garante que fique acima do fundo */
    }

    /* COLUNA ESQUERDA (FORMUL√ÅRIO) */
    .form-container {
        background: var(--bg-card);
        padding: 10px;
        border-radius: var(--border-radius);
        width: 480px; /* Largura fixa para o menu */
        min-width: 350px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        
        /* A M√ÅGICA DA ROLAGEM INTERNA */
        overflow-y: auto; 
        height: 100%; 
        box-sizing: border-box;
    }

    /* Scrollbar Bonita (Chrome/Edge/Safari) */
    .form-container::-webkit-scrollbar { width: 8px; }
    .form-container::-webkit-scrollbar-track { background: transparent; }
    .form-container::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.2); border-radius: 4px; }

    /* COLUNA DIREITA (PREVIEW) */
    .preview-container { 
        flex-grow: 1; 
        display: flex; 
        flex-direction: column; 
        height: 100%;
        min-width: 0; /* Impede overflow flexbox */
    }

    /* O Iframe ocupa todo o resto do espa√ßo dispon√≠vel */
    #previewFrame { 
        flex-grow: 1; 
        width: 100%; 
        border: none;
        border-radius: var(--border-radius);
        background: #525659; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    /* --- MOBILE (Reseta para rolagem normal se a tela for pequena) --- */
    @media (max-width: 800px) {
        html, body { overflow: auto; height: auto; }
        #container { flex-direction: column; height: auto; }
        .form-container { width: 100%; height: auto; overflow-y: visible; }
        .preview-container { height: 600px; }
    }

    /* --- ESTILOS DOS COMPONENTES --- */
    .theme-selector {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color);
        flex-shrink: 0;
    }
    .theme-selector select {
        padding: 2px 4px; border-radius: 4px; border: 1px solid var(--border-color);
        background: var(--input-bg); color: var(--text-main); cursor: pointer;
    }

    fieldset { border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 8px; margin-bottom: 8px; background: rgba(255,255,255,0.2); }
    legend { font-weight: bold; padding: 0 3px; color: var(--primary-color); background: rgba(255,255,255,0.6); border-radius: 3px; }
    label { display: block; margin-top: 5px; font-weight: 500; font-size: 0.9rem; }

    input:not([type="checkbox"]), textarea, select {
        width: 100%; padding: 5px; margin-top: 3px;
        border: 1px solid var(--border-color);
        background: var(--input-bg);
        color: var(--text-main);
        border-radius: 6px; box-sizing: border-box;
        font-size: 0.95rem;
        transition: border-color 0.2s;
    }
    input:focus, textarea:focus { outline: none; border-color: var(--primary-color); }

    button {
        padding: 6px 12px; border: none; background: var(--primary-color); color: #fff;
        border-radius: 6px; cursor: pointer; transition: all 0.2s;
        font-weight: 500; font-size: 0.95rem; margin-top: 10px;
    }
    button:hover { background: var(--primary-hover); transform: translateY(-1px); }

    /* Checkbox Styles */
    .checkbox-label {
        display: flex !important; align-items: flex-start; margin-top: 8px !important; cursor: pointer;
        font-size: 0.9rem; font-weight: normal; color: var(--text-main);
    }
    .checkbox-label input[type="checkbox"] {
        width: 14px !important; height: 18px; margin-right: 10px; margin-top: 2px; flex-shrink: 0; cursor: pointer;
    }

    /* Drag Zone */
    .drop-zone {
        border: 2px dashed var(--drop-zone-border);
        border-radius: var(--border-radius);
        padding: 10px; text-align: center;
        background: var(--drop-zone-bg);
        transition: all 0.2s ease; cursor: pointer; position: relative;
    }
    .drop-zone:hover, .drop-zone.drag-over { border-color: var(--primary-color); background: rgba(0, 119, 204, 0.05); }
    .drop-zone input[type="file"] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

    /* Estilo da lista de imagens */
    .img-tag {
        background: var(--primary-color);
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-right: 5px;
        margin-top: 5px;
        display: inline-block;
    }

    /* Barra Superior do Preview */
    .button-row { 
        display: flex; gap: 6px; align-items: center; margin-bottom: 8px; flex-wrap: wrap; 
        background: var(--bg-card); padding: 8px; border-radius: var(--border-radius);
        border: 1px solid var(--border-color); flex-shrink: 0;
    }
    
    #messageBox { 
        margin-top: 10px; padding: 10px; border-radius: var(--border-radius); 
        background: #fdd; color: #900; display: none; text-align: center; font-size: 0.9rem;
    }
    #statusIndicator { font-size: 0.85rem; color: #888; margin-left: auto; font-style: italic; background: rgba(255,255,255,0.5); padding: 2px 5px; border-radius: 4px; }
    </style>
</head>
<body>

<div id="container">
  
  <div class="form-container">
    
    <fieldset>
      <legend>Dados da Notifica√ß√£o</legend>
      <label>Telefone(s):</label>
      <input type="tel" id="telefone" placeholder="(44) 99999-9999" class="auto-update">
      
      <label>Nome(s):</label>
      <input type="text" id="nomeContato" placeholder="Nome completo" class="auto-update">
      
      <label>Endere√ßo:</label>
      <input type="text" id="endereco" placeholder="Endere√ßo completo" class="auto-update">
      
      <label>Ocorr√™ncia:</label>
      <textarea id="ocorrencia" rows="4" placeholder="Parecer..." class="auto-update"></textarea>
      
      <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid var(--border-color);">
        <label style="font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 6px;">Frases R√°pidas</label>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            
            <label class="checkbox-label" style="margin-top: 0 !important;">
                <input type="checkbox" class="presetPhrase" data-text="Contato realizado via WhatsApp com , onde foi enviada a notifica√ß√£o. Comprovante em anexo."> 
                WhatsApp enviado
            </label>

            <label class="checkbox-label" style="margin-top: 0 !important;">
                <input type="checkbox" class="presetPhrase" data-text="Cadastro incompleto. Ap√≥s tr√™s tentativas de entrega nos dias, foi deixada a notifica√ß√£o. Comprovante em anexo."> 
                Cadastro incompleto
            </label>

            <label class="checkbox-label" style="margin-top: 0 !important;">
                <input type="checkbox" class="presetPhrase" data-text="Terreno baldio, n√£o foi poss√≠vel localizar herdeiro(a) ou atual propriet√°rio. Comprovante em anexo."> 
                Terreno baldio
            </label>

            <label class="checkbox-label" style="margin-top: 0 !important;">
                <input type="checkbox" class="presetPhrase" data-text="Contribuinte recusou receber a notifica√ß√£o. Comprovante em anexo."> 
                Recusa
            </label>

            <label class="checkbox-label" style="margin-top: 0 !important; grid-column: span 2;">
                <input type="checkbox" class="presetPhrase" data-text="Tentativa de contato via WhatsApp sem sucesso e n√£o encontrada empresa/socio no endere√ßo cadastrado. N√£o foi poss√≠vel notificar."> 
                Empresa fechada
            </label>

        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Arquivo PDF Original</legend>
      <div class="drop-zone" id="pdfDropZone">
          <input type="file" id="fileInput" accept="application/pdf">
          <div style="font-size: 8px;">üìÑ</div>
          <p><strong>Clique ou Arraste</strong><br> PDF aqui</p>
      </div>
      <div id="fileInfo" style="margin-top: 8px; font-size: 0.85rem; color: #2e7d32; font-weight: bold; display: none;">Arquivo carregado!</div>
    </fieldset>

    <fieldset>
      <legend>Anexos </legend>
      <div class="drop-zone" id="imgDropZone">
          <input type="file" id="imgInput" accept="image/*" multiple>
          <div style="font-size: 8px;">üñºÔ∏è</div>
          <p><strong>Clique ou Arraste</strong><br>Imagens aqui</p>
      </div>
      <div id="imgListContainer" style="margin-top: 8px;"></div>
    </fieldset>

    <div id="messageBox"></div>
    <div style="margin-top: auto; padding-top: 6px;">
        <button id="clearBtn" style="width: 100%; background: #d32f2f;">Limpar Tudo</button>
    </div>
  </div>

  <div class="preview-container">
    <div class="button-row">
      <button id="previewBtn" style="margin:0;">üîÑ Atualizar</button>
      <button id="downloadBtn" style="margin:0; background: #2e7d32;">üíæ Baixar PDF</button>
      <span id="statusIndicator"></span>
      <div class="theme-selector">
        <select id="themeSelect">
            <option value="default">üîµ Azul (Padr√£o)</option>
            <option value="palmeiras">üê∑ Verd√£o (Palmeiras)</option>
            <option value="gold">üü° Dourado</option>
            <option value="pink">üå∏ Rosa</option>
            <option value="purple">üü£ Roxo</option>
            <option value="dark">üåë Modo Escuro</option>
        </select>
    </div>
    </div>
    <iframe id="previewFrame"></iframe>
  </div>
</div>

<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    
    // Agora o estado guarda o PDF E a lista de imagens
    const AppState = { pdfBuffer: null, images: [], isProcessing: false };
    
    const CONFIG = {
      margins: { left: 41, right: 41, top: 30, bottom: 40 },
      fontSize: { title: 11, label: 10, content: 10 },
      spacing: { label: 12 },
      maxRectHeight: 180
    };

    function showMessage(msg, isError = true) {
      const box = document.getElementById("messageBox");
      box.textContent = msg;
      box.style.background = isError ? "#fdd" : "#dfd";
      box.style.color = isError ? "#900" : "#050";
      box.style.display = "block";
      setTimeout(() => box.style.display = "none", 4000);
    }

    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), wait);
        };
    }

    function setStatus(msg) {
        const indicator = document.getElementById('statusIndicator');
        const btn = document.getElementById('previewBtn');
        indicator.textContent = msg;
        if (msg) {
            btn.textContent = "‚è≥...";
            document.getElementById('previewFrame').style.opacity = "0.7";
        } else {
            btn.textContent = "üîÑ Atualizar";
            document.getElementById('previewFrame').style.opacity = "1";
        }
    }

    async function loadPdfFile(file) {
        if (!file || file.type !== 'application/pdf') {
            showMessage("Selecione um PDF v√°lido.");
            return;
        }
        try {
            AppState.pdfBuffer = await file.arrayBuffer();
            document.getElementById("fileInfo").style.display = "block";
            document.getElementById("fileInfo").textContent = `‚úÖ ${file.name}`;
            showMessage("Carregando...", false);
            triggerPreviewUpdate();
        } catch (e) {
            showMessage("Erro: " + e.message);
        }
    }

    // Fun√ß√£o para adicionar imagens ao estado e atualizar UI
    function handleImageFiles(files) {
        const newFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
        if (newFiles.length === 0) return;

        // Adiciona ao array global
        AppState.images.push(...newFiles);

        // Atualiza a visualiza√ß√£o da lista
        const container = document.getElementById('imgListContainer');
        container.innerHTML = ''; // Limpa e redesenha
        AppState.images.forEach(img => {
            const tag = document.createElement('span');
            tag.className = 'img-tag';
            tag.textContent = img.name;
            container.appendChild(tag);
        });

        triggerPreviewUpdate();
    }

    async function gerarPdfBytes() {
      if (!AppState.pdfBuffer) throw new Error("PDF base n√£o carregado.");
      
      const newPdfDoc = await PDFLib.PDFDocument.load(AppState.pdfBuffer);
      const totalPages = newPdfDoc.getPageCount();
      [6, 4, 2, 0].forEach(index => { if (totalPages > index) newPdfDoc.removePage(index); });

      const remainingPages = newPdfDoc.getPages();
      const { width, height } = remainingPages[0].getSize();
      const firstPage = newPdfDoc.insertPage(0, [width, height]);

      const fontBold = await newPdfDoc.embedFont(PDFLib.StandardFonts.HelveticaBold);
      const fontRegular = await newPdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);

      const fields = [
        {label:"Telefone(s):", value: document.getElementById("telefone").value},
        {label:"Nome(s):", value: document.getElementById("nomeContato").value},
        {label:"Endere√ßo:", value: document.getElementById("endereco").value},
        {label:"Ocorr√™ncia/Parecer:", value: document.getElementById("ocorrencia").value}
      ].filter(f => f.value.trim() !== '');

      const rectWidth = width - (CONFIG.margins.left * 2);
      const rectX = CONFIG.margins.left;
      const rectY = height - CONFIG.maxRectHeight - CONFIG.margins.top; 
      
      firstPage.drawRectangle({
        x: rectX, y: rectY, width: rectWidth, height: CONFIG.maxRectHeight,
        borderColor: PDFLib.rgb(0,0,0), borderWidth: 1, color: PDFLib.rgb(1,1,1), borderRadius: 5
      });

      const title = "ENTREGA DE NOTIFICA√á√ïES - JUDICIAL";
      const titleWidth = fontBold.widthOfTextAtSize(title, CONFIG.fontSize.title);
      const titleX = rectX + (rectWidth - titleWidth) / 2;
      firstPage.drawText(title, { x: titleX, y: rectY + CONFIG.maxRectHeight - 20, size: CONFIG.fontSize.title, font: fontBold });

      let currentY = rectY + CONFIG.maxRectHeight - 35;
      fields.forEach(field => {
          firstPage.drawText(field.label, { x: rectX + 12, y: currentY, size: CONFIG.fontSize.label, font: fontBold });
          const labelW = fontBold.widthOfTextAtSize(field.label, CONFIG.fontSize.label);
          const maxTextW = rectWidth - 30 - labelW;
          const words = field.value.replace(/\n/g, ' ').split(' ');
          let line = '';
          let textX = rectX + 12 + labelW + 5;

          words.forEach(w => {
              const testLine = line ? line + ' ' + w : w;
              const testW = fontRegular.widthOfTextAtSize(testLine, CONFIG.fontSize.content);
              if (testW > maxTextW) {
                  firstPage.drawText(line, { x: textX, y: currentY, size: CONFIG.fontSize.content, font: fontRegular });
                  line = w;
                  currentY -= CONFIG.spacing.label;
                  textX = rectX + 12;
              } else {
                  line = testLine;
              }
          });
          if (line) firstPage.drawText(line, { x: textX, y: currentY, size: CONFIG.fontSize.content, font: fontRegular });
          currentY -= (CONFIG.spacing.label + 4);
      });

      // L√ìGICA DE IMAGENS ATUALIZADA (L√™ do Array em vez do DOM)
      if (AppState.images.length > 0) {
          const usableWidth = width - (CONFIG.margins.left * 2);
          for (let i = 0; i < AppState.images.length; i++) {
            const bytes = await AppState.images[i].arrayBuffer();
            const isPng = AppState.images[i].type === 'image/png';
            const img = isPng ? await newPdfDoc.embedPng(bytes) : await newPdfDoc.embedJpg(bytes);

            if (i === 0) {
              const usableH = rectY - CONFIG.margins.bottom - 20;
              const scale = Math.min(usableWidth / img.width, usableH / img.height);
              const imgW = img.width * scale;
              const imgH = img.height * scale;
              firstPage.drawImage(img, { x: (width - imgW) / 2, y: rectY - imgH - 10, width: imgW, height: imgH });
            } else {
              const newPage = newPdfDoc.addPage([width, height]);
              const scale = Math.min(usableWidth / img.width, (height - 100) / img.height);
              const imgW = img.width * scale;
              const imgH = img.height * scale;
              newPage.drawImage(img, { x: (width - imgW) / 2, y: (height - imgH) / 2, width: imgW, height: imgH });
            }
          }
      }
      return await newPdfDoc.save();
    }

    /* --- CONFIGURA√á√ÉO DRAG AND DROP (PDF) --- */
    const pdfDropZone = document.getElementById('pdfDropZone');
    const pdfInput = document.getElementById('fileInput');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        pdfDropZone.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }, false);
    });

    pdfDropZone.addEventListener('dragover', () => pdfDropZone.classList.add('drag-over'));
    pdfDropZone.addEventListener('dragleave', () => pdfDropZone.classList.remove('drag-over'));
    pdfDropZone.addEventListener('drop', (e) => {
        pdfDropZone.classList.remove('drag-over');
        if (e.dataTransfer.files.length) loadPdfFile(e.dataTransfer.files[0]);
    });
    pdfInput.addEventListener('change', (e) => { if (e.target.files.length) loadPdfFile(e.target.files[0]); });

    /* --- CONFIGURA√á√ÉO DRAG AND DROP (IMAGENS) --- */
    const imgDropZone = document.getElementById('imgDropZone');
    const imgInput = document.getElementById('imgInput');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        imgDropZone.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }, false);
    });

    imgDropZone.addEventListener('dragover', () => imgDropZone.classList.add('drag-over'));
    imgDropZone.addEventListener('dragleave', () => imgDropZone.classList.remove('drag-over'));
    
    // Drop de Imagens
    imgDropZone.addEventListener('drop', (e) => {
        imgDropZone.classList.remove('drag-over');
        if (e.dataTransfer.files.length) handleImageFiles(e.dataTransfer.files);
    });
    
    // Sele√ß√£o manual de imagens
    imgInput.addEventListener('change', (e) => { 
        if (e.target.files.length) handleImageFiles(e.target.files); 
    });


    // --- DEBOUNCE E UPDATES ---
    const triggerPreviewUpdate = debounce(async () => {
        if (!AppState.pdfBuffer) return;
        try {
            setStatus("Gerando...");
            const pdfBytes = await gerarPdfBytes();
            const blob = new Blob([pdfBytes], {type: "application/pdf"});
            const oldSrc = document.getElementById("previewFrame").src;
            if (oldSrc) URL.revokeObjectURL(oldSrc);
            document.getElementById("previewFrame").src = URL.createObjectURL(blob);
        } catch (e) { console.log("Aguardando dados..."); } 
        finally { setStatus(""); }
    }, 1000);

    document.querySelectorAll('.auto-update').forEach(input => input.addEventListener('input', triggerPreviewUpdate));
    
    document.querySelectorAll('.presetPhrase').forEach(cb => {
        cb.addEventListener('change', () => {
            const textArea = document.getElementById('ocorrencia');
            const selected = Array.from(document.querySelectorAll('.presetPhrase:checked')).map(c => c.dataset.text);
            textArea.value = selected.join('\n');
            textArea.dispatchEvent(new Event('input'));
        });
    });

    document.getElementById("previewBtn").addEventListener("click", triggerPreviewUpdate);
    
    document.getElementById("downloadBtn").addEventListener("click", async () => {
      try {
        setStatus("Baixando...");
        const bytes = await gerarPdfBytes();
        const blob = new Blob([bytes], {type: "application/pdf"});
        const nomeArquivo = "Notificacao_Campo_Mourao.pdf";

        if (window.showSaveFilePicker) {
            const handle = await window.showSaveFilePicker({ suggestedName: nomeArquivo, types: [{ description: 'PDF', accept: { 'application/pdf': ['.pdf'] } }] });
            const writable = await handle.createWritable();
            await writable.write(blob);
            await writable.close();
        } else {
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = nomeArquivo;
            link.click();
        }
      } catch(e) { showMessage(e.message); } 
      finally { setStatus(""); }
    });

    document.getElementById("clearBtn").addEventListener("click", () => location.reload());

    // M√°scara e Formata√ß√£o
    document.getElementById('telefone').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 11) value = value.slice(0, 11);
        if (value.length > 10) value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
        else if (value.length > 5) value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
        else if (value.length > 2) value = value.replace(/^(\d{2})(\d{0,5}).*/, '($1) $2');
        e.target.value = value;
    });

    ['nomeContato', 'endereco'].forEach(id => {
        document.getElementById(id).addEventListener('input', function (e) {
            let start = this.selectionStart; let end = this.selectionEnd;
            this.value = this.value.replace(/(?:^|\s)\S/g, function(a) { return a.toUpperCase(); });
            this.setSelectionRange(start, end);
        });
    });

    document.getElementById('ocorrencia').addEventListener('input', function (e) {
        let start = this.selectionStart; let end = this.selectionEnd;
        if (this.value.length > 0) this.value = this.value.charAt(0).toUpperCase() + this.value.slice(1);
        this.setSelectionRange(start, end);
    });

    const themeSelect = document.getElementById('themeSelect');
    themeSelect.addEventListener('change', (e) => {
        document.body.className = '';
        if (e.target.value !== 'default') document.body.classList.add('theme-' + e.target.value);
        localStorage.setItem('selectedTheme', e.target.value);
    });
    const saved = localStorage.getItem('selectedTheme') || 'default';
    if(saved !== 'default') document.body.classList.add('theme-' + saved);
    themeSelect.value = saved;
});
</script>
</body>
</html>
